# Use the latest Alpine Linux as the base image
FROM alpine:latest

# Install necessary dependencies
RUN apk add --no-cache bash curl wget ca-certificates libstdc++ 

# Download and install Mambaforge for ARM architecture
# Replace 'aarch64' with your architecture if different (e.g., 'armv7l' for 32-bit ARM)
RUN wget --quiet https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-Linux-aarch64.sh && \
    bash Mambaforge-Linux-aarch64.sh -b -p /opt/conda && \
    rm Mambaforge-Linux-aarch64.sh

# Update PATH environment variable
ENV PATH="/opt/conda/bin:$PATH"

# Copy environment.yml to the Docker image
COPY environment.yml .

# Create the Conda environment from environment.yml using mamba (faster than conda)
RUN mamba env update -f environment.yml && conda clean -afy

# Install Jupyter Notebook (or JupyterLab) using mamba
RUN mamba install -y jupyterlab && conda clean -afy

# Expose the default Jupyter port
EXPOSE 8888

# Set environment variables for Jupyter
ENV JUPYTER_TOKEN=""  # Disables the token for easier access, consider setting a token for security
ENV JUPYTER_ENABLE_LAB=yes  # To start JupyterLab instead of the classic Jupyter Notebook

# Set the working directory
WORKDIR /home

# Command to run Jupyter Notebook or JupyterLab on container start
CMD ["jupyter", "lab", "--ip=0.0.0.0", "--port=8888", "--no-browser", "--allow-root"]
